{"ast":null,"code":"import _objectSpread from \"/Users/yangpu-bt/personal/moonlt3/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/yangpu-bt/personal/moonlt3/src/routes/index.js\";\nimport React, { Component } from 'react';\nimport Loadable from 'react-loadable';\nimport { Route, Redirect, Switch } from 'react-router-dom';\nimport { getAsyncInjectors } from '../utils/asyncInjectors';\nimport queryString from 'query-string';\nimport hello from './Hello';\nimport hi from './Hi';\nconst modules = {\n  menus: [hello, hi],\n  others: []\n}; // 为了根据模块名称找到文件\n\nconst convFirstChartUpper = str => str.substr(0, 1).toUpperCase() + str.substr(1);\n\nexport default function CRouter(store) {\n  const _getAsyncInjectors = getAsyncInjectors(store),\n        injectReducer = _getAsyncInjectors.injectReducer,\n        injectSagas = _getAsyncInjectors.injectSagas;\n\n  const requireAuth = (permission, component) => {\n    const userData = store.getState().toJS().config.userData;\n    const permissions = userData.permissions; // const { auth } = store.getState().httpData;\n\n    if (!permissions || !permissions.includes(permission)) return React.createElement(Redirect, {\n      to: '/404',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 26\n      },\n      __self: this\n    });\n    return component;\n  };\n\n  const requireLogin = (component, permission) => {\n    const userData = store.getState().toJS().config.userData;\n    const permissions = userData.permissions;\n\n    if (process.env.NODE_ENV === 'production' && !permissions) {\n      // 线上环境判断是否登录\n      return React.createElement(Redirect, {\n        to: '/login',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 33\n        },\n        __self: this\n      });\n    }\n\n    return permission ? requireAuth(permission, component) : component;\n  };\n\n  return React.createElement(Switch, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38\n    },\n    __self: this\n  }, modules.menus.map(ele => {\n    const route = (ele, parentPath) => {\n      const elePath = ele.path ? convFirstChartUpper(ele.path) : '';\n      const eleRoute = ele.route ? convFirstChartUpper(ele.route) : '';\n      const routePath = \"\".concat(parentPath || '').concat('/' + eleRoute);\n      const finalPath = \"\".concat(parentPath || '').concat('/' + elePath);\n      let Component = '';\n      const importModules = Promise.all([ele.hasReducer && import(\"../containers/Pages\".concat(finalPath, \"/reducer\")), ele.hasSagas && import(\"../containers/Pages\".concat(finalPath, \"/sagas\"))]);\n      importModules.then(([reducer, sagas]) => {\n        const reducerName = finalPath.substr(1);\n        reducer && injectReducer(reducerName, reducer.default);\n        sagas && injectSagas(sagas.default);\n        Component = Loadable({\n          loader: () => import(\"../containers/Pages\".concat(finalPath)),\n\n          loading() {\n            return React.createElement(\"div\", {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 58\n              },\n              __self: this\n            }, \"\\u52A0\\u8F7D\\u4E2D\\u5662......\");\n          }\n\n        });\n      });\n\n      if (Component) {}\n\n      return React.createElement(Route, {\n        key: ele.path,\n        exact: !(ele.child && ele.child.length > 0) // exact\n        ,\n        path: routePath,\n        render: props => {\n          const reg = /\\?\\S*/g; // 匹配?及其以后字符串\n\n          const queryParams = window.location.hash.match(reg); // 去除?的参数\n\n          const params = props.match.params;\n          Object.keys(params).forEach(key => {\n            params[key] = params[key] && params[key].replace(reg, '');\n          });\n          props.params = _objectSpread({}, params);\n\n          const merge = _objectSpread({}, props, {\n            query: queryParams ? queryString.parse(queryParams[0]) : {}\n          }); // if ( ele.child && ele.child.length > 0 ) {\n\n\n          const finalNode = React.createElement(Component, Object.assign({}, merge, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 84\n            },\n            __self: this\n          }), React.createElement(Switch, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 85\n            },\n            __self: this\n          }, ele.child && ele.child.length > 0 && ele.child.map(r => route(r, props.match.path)), React.createElement(Redirect, {\n            to: \"/404\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 87\n            },\n            __self: this\n          })));\n          return requireLogin(finalNode, finalPath.substr(1)); // }\n          // return requireLogin(<Component {...props} />, finalPath.substr(1))\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 66\n        },\n        __self: this\n      });\n    };\n\n    return route(ele);\n  }), React.createElement(Redirect, {\n    to: \"/404\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101\n    },\n    __self: this\n  }));\n}","map":{"version":3,"sources":["/Users/yangpu-bt/personal/moonlt3/src/routes/index.js"],"names":["React","Component","Loadable","Route","Redirect","Switch","getAsyncInjectors","queryString","hello","hi","modules","menus","others","convFirstChartUpper","str","substr","toUpperCase","CRouter","store","injectReducer","injectSagas","requireAuth","permission","component","userData","getState","toJS","config","permissions","includes","requireLogin","process","env","NODE_ENV","map","ele","route","parentPath","elePath","path","eleRoute","routePath","finalPath","importModules","Promise","all","hasReducer","hasSagas","then","reducer","sagas","reducerName","default","loader","loading","child","length","props","reg","queryParams","window","location","hash","match","params","Object","keys","forEach","key","replace","merge","query","parse","finalNode","r"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Loadable from 'react-loadable';\nimport { Route, Redirect, Switch } from 'react-router-dom';\nimport { getAsyncInjectors } from '../utils/asyncInjectors';\nimport queryString from 'query-string';\n\nimport hello from './Hello';\nimport hi from './Hi';\nconst modules = {\n  menus: [\n    hello,\n    hi,\n  ],\n  others: []\n};\n\n// 为了根据模块名称找到文件\nconst convFirstChartUpper = (str) => str.substr(0, 1).toUpperCase() + str.substr(1);\n\nexport default function CRouter(store) {\n  const { injectReducer, injectSagas } = getAsyncInjectors(store);\n  const requireAuth = (permission, component) => {\n      const { userData } = store.getState().toJS().config;\n      const { permissions } = userData;\n      // const { auth } = store.getState().httpData;\n      if (!permissions || !permissions.includes(permission)) return <Redirect to={'/404'} />;\n      return component;\n  };\n  const requireLogin = (component, permission) => {\n      const { userData } = store.getState().toJS().config;\n      const { permissions } = userData;\n      if (process.env.NODE_ENV === 'production' && !permissions) { // 线上环境判断是否登录\n          return <Redirect to={'/login'} />;\n      }\n      return permission ? requireAuth(permission, component) : component;\n  };\n  return (\n    <Switch>\n      {\n        modules.menus.map(ele => {\n          const route = (ele, parentPath) => {\n            const elePath = ele.path ? convFirstChartUpper(ele.path) : '';\n            const eleRoute = ele.route ? convFirstChartUpper(ele.route) : '';\n            const routePath = `${parentPath || ''}${'/'+eleRoute}`;\n            const finalPath = `${parentPath || ''}${'/'+elePath}`;\n            let Component = '';\n            const importModules = Promise.all([\n              ele.hasReducer && import(`../containers/Pages${finalPath}/reducer`),\n              ele.hasSagas && import(`../containers/Pages${finalPath}/sagas`)\n            ])\n            importModules.then(([reducer, sagas]) => {\n              const reducerName = finalPath.substr(1)\n              reducer && injectReducer(reducerName, reducer.default);\n              sagas && injectSagas(sagas.default);\n              Component = Loadable({\n                loader: () => import(`../containers/Pages${finalPath}`),\n                loading() {\n                  return <div>加载中噢......</div>\n                },\n              });\n            })\n            if (Component) {\n              \n            }\n            return (\n              <Route\n                key={ele.path}\n                exact={!(ele.child && ele.child.length > 0)}\n                // exact\n                path={routePath}\n                render={(props) => {\n                  const reg = /\\?\\S*/g;\n                  // 匹配?及其以后字符串\n                  const queryParams = window.location.hash.match(reg);\n                  // 去除?的参数\n                  const { params } = props.match;\n                  Object.keys(params).forEach(key => {\n                      params[key] = params[key] && params[key].replace(reg, '');\n                  });\n                  props.params = { ...params };\n                  const merge = { ...props, query: queryParams ? queryString.parse(queryParams[0]) : {} };\n                  // if ( ele.child && ele.child.length > 0 ) {\n                    const finalNode = (\n                      <Component {...merge}>\n                        <Switch>\n                          { ele.child && ele.child.length > 0 && ele.child.map((r) => route(r, props.match.path)) }\n                          <Redirect to=\"/404\" />\n                        </Switch>\n                      </Component>\n                    )\n                    return requireLogin(finalNode, finalPath.substr(1))\n                  // }\n                // return requireLogin(<Component {...props} />, finalPath.substr(1))\n                }}\n              />\n            )\n          }\n            return route(ele);\n          })\n      }  \n      <Redirect to=\"/404\" />\n    </Switch>\n  );\n}"]},"metadata":{},"sourceType":"module"}